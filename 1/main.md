# 数字电力模拟

## 为什么要做

我曾在学习数字电路的课程时，梦想做一个数字电路模拟程序，
用来模拟那些课堂上学到的数字电路。
当时我还未曾听过数字电路模拟程序这个名字，
后来在学习计组的时候了解到一款叫做 `Quartus` 的软件。
但这是一款用于开发 FPGA 和 CPLD 的软件，
并不能很好的完成数字电路和计组教具的任务。

后来又了解到了 `logisim` 这款用 java 编写的模拟软件，
它的设计之初的目的就是用作数电的教学工具。
虽然开发者当初选择 java 就是希望它能有一定的跨平台能力，
但随着计算机技术的发展导致的软件兼容性问题，
使得现在它的一些功能已经无法在 win10 上正常运行了。

如果一定要在现在选择一个跨平台的开发平台的话，web 浏览器平台是最合适的平台，
不管是三大操作系统 `windows` `linux` `macos` ，
还是手机的操作系统，只要是符合web浏览器规范的软件，就能正常工作。

基于 web 浏览器平台的模拟器有非常多，比如：

- [OpenCircuits](https://github.com/OpenCircuits/OpenCircuits)
- [Circuits](https://github.com/marcielbp/Circuits)
- [LogiJS](https://github.com/SimonBuxx/LogiJS)
- [Logic-Circuit-Simulator](https://github.com/saliherdemk/Logic-Circuit-Simulator)

但他们其中存在有一些缺点：

- 无法模拟延时门，也就无法模拟可调频的时钟电路
- 线的链接不美观，不横平竖直
- 多位线和单位线无法区分，多位线之间难以区分
- 缺少模块化功能，没有办法把复杂的电路作为一个模块去使用
- 没有 native 的组件接口，没法使用编程语言去扩展组件库
- 快捷键操作不灵活，鼠标操作费时费力

为了解决以上问题，有必要做一个新的 **基于 web 浏览器的数字电路模拟器**

## 设计

简单分析，这个软件由两个大的功能部分组成：

1. 创建/编辑 电路
2. 模拟/调试 电路

### 创建/编辑 电路

想要模拟调试电路，首先需要创建电路，想要创建电路，
则首先要要设计电路结构在计算机中的存储方式。

对于数字电路而言，则由基本的数字电路和连接线组成。

#### 逻辑门/信号线

对于这个模拟器而言，创建和编辑需要在一个 UI 界面上进行，
但 UI 层的电路信息对于模拟和描述一个电路是过剩的，
所以需要分成 `逻辑层` 和 `视图层` 单独讨论。

##### 逻辑层

基本的数字逻辑门包括：

- 非门
- 或门
- 与门

只需要 与非门 就可以造出以上三个个基本逻辑门，
只需要以上三个逻辑门，就可以制造绝大多数数字逻辑电路。

但只有基础的数字逻辑门还无法完成一些其他的功能，
比如线与和线或，比如震荡电路。
为了实现这些功能，有必要添加以下两个基本原件：

- 延迟门 ( 和非门构成一个振荡器 )
- 三态门 ( 做收数字信号控制的高阻态输出 )

模拟电路时，主要考虑的是器件之间链接的拓扑结构。
那么就有几个主要的考虑方向：

- 器件是否带有输入输出的方向性？
- 线路是否具有输入输出的方向性？
- 线路信号改变时，扇出的几个模块的信号更新顺序如何确定？

以上这三点直接涉及到了电路状态的更新算法如何设计，
针对以上三个问题的不同回答，可以设计出多种具有不同性质的模拟算法。

如果这个程序想要模拟一些超出小型规模的电路，
那么需要提供电路模块化的能力。

##### 视图层

逻辑层的电路只设计拓扑链接，即那根信号线链接到那几个电路模块的哪个接口上，
而视图层则要考虑模块和线路在视图中的位置。

对于模块，要考虑它的：

- 大小
- 接口位置
- 试图中的位置
- 图片样式 ( 模块所展示出来的形状 )

对于信号线，则要考虑它的：

- 链接到的模块接口的位置 ( 起始位置和终点位置 )
- 中间转折点的位置
- 信号线的样式

